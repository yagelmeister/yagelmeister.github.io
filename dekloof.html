<!doctype html>
<html>
<head>
  <script>
    (function(){
      var lang = localStorage.getItem("yagel_lang") || "en";
      document.documentElement.setAttribute("data-lang", lang);
      document.documentElement.lang = lang;
    })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yagel.nl - de kloof</title>
  <meta name="description" content="meals for homeless people" />

  <link rel="stylesheet" href="styling.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
  <div class="wrap">
    <header>
      <div class="topbar" aria-label="Taal kiezen">
        <button class="lang-btn" type="button" data-lang="nl" aria-pressed="true">nl</button>
        <button class="lang-btn" type="button" data-lang="en" aria-pressed="false">en</button>
      </div>

      <div class="name">
        <a href="home.html" data-i18n="name">YA'GEL SCHOONDERBEEK</a>
      </div>
      <div class="rule"></div>
    </header>

    <main class="masonry" aria-label="DE KLOOF">
      <div id="col-a" class="masonry-col">
        <div class="card intro tilt-1">
            <div class="label" data-i18n="intro_label">DAKLOZENOPVANG DE KLOOF</div>
            <div class="meta" data-i18n="intro_meta">Beshcrijving</div>
        </div>
      </div>

      <div id="col-b" class="masonry-col"></div>
    </main>

    <footer>
      <a class="pill" href="cheffie.html" data-i18n="pill_cheffie">CHEF YAKKI</a>
      <a class="pill" href="home.html" data-i18n="pill_home">HOME</a>
      <a class="pill" href="#" id="contactLink" data-i18n="pill_contact">CONTACT</a>
    </footer>
  </div>

  <script>
    (function(){
      var savedTheme = localStorage.getItem("theme");
      document.documentElement.setAttribute("data-theme", savedTheme || "auto");
    })();

    var SETS = [
      {
        title: { nl: "VEGAN SAOTO SOEP", en: "VEGAN SAOTO SOUP" },
        desc:  { nl: "gekruide kool als vervanger van kip", en: "spiced cabbage as replacement of chicken" },
        photos: [
          "images/koken/daklozenopvang/saoto/saoto1.jpg",
          "images/koken/daklozenopvang/saoto/saoto2.jpg",
          "images/koken/daklozenopvang/saoto/saoto3.jpg",
          "images/koken/daklozenopvang/saoto/saoto4.jpg",
        ],
        tilt:  "tilt-3"
      },  
      {
        title: { nl: "PASTA SAUS MET ISIS", en: "PASTA SAUCE WITH ISIS" },
        desc:  { nl: "gegrilde tomaten en paprikas in de oven", en: "grilled tomatoes and bell peppers in the oven" },
        photos: [
          "images/koken/daklozenopvang/isis saus/saus0.jpg",
          "images/koken/daklozenopvang/isis saus/saus1.jpg",
          "images/koken/daklozenopvang/isis saus/saus2.jpg",
          "images/koken/daklozenopvang/isis saus/saus3.5.jpg",
          "images/koken/daklozenopvang/isis saus/saus4.jpg",
          "images/koken/daklozenopvang/isis saus/saus6.jpg",
        ],
        tilt:  "tilt-3"
      },  
      {
        title: { nl: "Hamburgers met de papi's", en: "Hamburgers with the papis" },
        desc:  { nl: "met roel, bart en enrikos 90 hamburgers gemaakt (inclusief de broodjes en mayo)", en: "with roel, bart and enrikos, we made 90 hamburgers (including the breads and mayo)" },
        photos: [
          "images/koken/daklozenopvang/burgers papi/burger1.jpg",
          "images/koken/daklozenopvang/burgers papi/burger2.jpg",
          "images/koken/daklozenopvang/burgers papi/burger4.jpg",
          "images/koken/daklozenopvang/burgers papi/burger5.jpg",
          "images/koken/daklozenopvang/burgers papi/burger3.jpg",
          "images/koken/daklozenopvang/burgers papi/burger6.jpg",
          "images/koken/daklozenopvang/burgers papi/burger7.jpg",
        ],
        tilt:  "tilt-1"
      },
      {
        title: { nl: "René", en: "René" },
        desc:  { nl: "blij met gedoneerd zuurdesem brood van de bakker", en: "happy with the donated sourdough bread from the bakery" },
        photos: [
          "images/koken/daklozenopvang/rene brood.jpg",
        ],
        tilt:  "tilt-1"
      },
      {
        title: { nl: "Degen met marie en jeremy", en: "Dough with marie and jeremy" },
        desc:  { nl: "de leukste / uitdagende dagen zijn die waar we ook het deeg maken, zoals deze twee verschillende keren", en: "the most fun / challenging days are those where we also make the dough, like these two seperate times" },
        photos: [
          "images/koken/daklozenopvang/degen/deeg1.jpg",
          "images/koken/daklozenopvang/degen/deeg2.jpg",
          "images/koken/daklozenopvang/degen/deeg3.jpg",
          "images/koken/daklozenopvang/degen/deeg4.jpg",
          "images/koken/daklozenopvang/degen/deeg5.jpg",
        ],
        tilt:  "tilt-2"
      },
      {
        title: { nl: "TORTILLAS MET MARTIJN", en: "TORTILLAS WITH MARTIJN" },
        desc:  { nl: "mijn data-baas kwam mee tortillas maken; van deeg tot salsa", en: "my employer of Nidap joined to make tortillas; from dough to salsa" },
        photos: [
          "images/koken/daklozenopvang/martijn tortillas/tortillas4.jpg",
          "images/koken/daklozenopvang/martijn tortillas/tortillas5.jpg",
          "images/koken/daklozenopvang/martijn tortillas/tortillas1.jpg",
          "images/koken/daklozenopvang/martijn tortillas/tortillas3.jpg",
          "images/koken/daklozenopvang/martijn tortillas/tortillas2.jpg",
          "images/koken/daklozenopvang/martijn tortillas/tortillas7.jpg",
        ],
        tilt:  "tilt-3"
      }
    ];

    function escapeHtml(str){
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    var SLIDER_LABELS = {
      nl: { prev: "vorige", next: "volgende" },
      en: { prev: "prev", next: "next" }
    };

    function renderSets(lang){
      var colA = document.getElementById('col-a');
      if(!colA) return;
      var colB = document.getElementById('col-b');
      if(!colB) return;

      SETS.forEach(function(s, idx){
        var card = document.createElement("div");
        card.className = "card player " + (s.tilt || "") + " " + (s.size || "");

        var title = (s.title && (s.title[lang] || s.title.nl)) || "Set";
        var desc  = s.desc ? (s.desc[lang] || s.desc.nl || "") : "";
        var photos = Array.isArray(s.photos) ? s.photos : [];
        var sliderId = "slider-" + idx;

        var labels = SLIDER_LABELS[lang] || SLIDER_LABELS.en;

        var photos = Array.isArray(s.photos) ? s.photos : [];
        var first = photos[0];
        var last  = photos[photos.length - 1];

        var loopPhotos;
        if(photos.length > 1){
          loopPhotos = [last].concat(photos).concat([first]); // clone-last + echte fotos + clone-first
        }else{
          loopPhotos = photos.slice();
        }

        card.innerHTML =
          '<div>' +
            '<div class="label">' + escapeHtml(title) + '</div>' +
            '<div class="meta">photos</div>' +
            (desc ? '<div class="desc">' + escapeHtml(desc) + '</div>' : '') +

            '<div class="slider" data-slider-id="' + sliderId + '">' +
              '<div class="slider-frame" aria-label="photo slider">' +

                '<div class="slider-track">' +
                  loopPhotos.map(function(p){
                    return '<img loading="eager" decoding="async" src="' + escapeHtml(p) + '" alt="">';
                  }).join("") +
                '</div>' +

                '<div class="slider-overlay" aria-hidden="true">' +
                  '<div class="slider-hover left"></div>' +
                  '<div class="slider-hover right"></div>' +
                '</div>' +

              '</div>' +
            '</div>' +

          '</div>';


        ((colA.offsetHeight <= colB.offsetHeight) ? colA : colB).appendChild(card);
      });

      wireSliders();
      autoAspectRatio();
    }

    function autoAspectRatio(){
      document.querySelectorAll(".slider-frame").forEach(function(frame){
        var imgs = Array.from(frame.querySelectorAll("img"));
        if(!imgs.length) return;

        var waits = imgs.map(function(img){
          return new Promise(function(resolve){
            if(img.complete && img.naturalWidth) return resolve();
            img.addEventListener("load", resolve, { once:true });
            img.addEventListener("error", resolve, { once:true });
          });
        });

        Promise.all(waits).then(function(){
          var maxRatio = 0;
          imgs.forEach(function(img){
            var w = img.naturalWidth || 0;
            var h = img.naturalHeight || 1;
            var r = w / h;
            if(r > maxRatio) maxRatio = r;
          });

          if(!maxRatio || !isFinite(maxRatio)) maxRatio = 16/9;
          frame.style.aspectRatio = String(maxRatio);
        });
      });
    }

    function wireSliders(){
      var SPEED_AUTO = 60;       // px per soconde
      var SPEED_USER = 100;       // px per soconde
      var AUTO_DELAY = 700;      // ms wachten na in-beeld komen / mouseleave
      var VIEW_THRESHOLD = 1.0;  // hoeveel van de slider in beeld moet zijn

      var io = ("IntersectionObserver" in window) ? new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          var frame = entry.target;
          var api = frame.__sliderApi;
          if(!api) return;

          api.inView = entry.isIntersecting && entry.intersectionRatio >= VIEW_THRESHOLD;

          if(!api.inView){
            api.stopAll();
          }else{
            api.maybeScheduleAuto();
          }
        });
      }, { threshold: [1] }) : null;

      document.querySelectorAll(".slider").forEach(function(slider){
        var frame = slider.querySelector(".slider-frame");
        var track = slider.querySelector(".slider-track");
        if(!frame || !track) return;

        var slides = Array.from(track.querySelectorAll("img"));
        if(slides.length < 2) return;

        var leftZone  = slider.querySelector(".slider-hover.left");
        var rightZone = slider.querySelector(".slider-hover.right");
        if(!leftZone || !rightZone) return;

        var dir = 0;
        var raf = null;
        var lastT = 0;

        var offset = 0;     // px
        var slideW = 0;     // px
        var realCount = 0;  // echte fotos (zonder clones)

        var hovering = false;
        var inView = false;

        var autoTimer = null;
        var autoDir = 1; // standaard auto naar rechts

        var api = { isAuto: false };

        function apply(){
          track.style.transform = "translateX(" + (-offset) + "px)";
        }

        function recalc(){
          slideW = frame.clientWidth;
          realCount = slides.length >= 3 ? (slides.length - 2) : slides.length;

          // startpositie: echte eerste (index 1) als we clones hebben
          if(slides.length >= 3 && offset === 0){
            offset = slideW;
          }
          apply();
        }

        function stopRAF(){
          if(raf){
            cancelAnimationFrame(raf);
            raf = null;
          }
          lastT = 0;
        }

        function tick(t){
          if(!lastT) lastT = t;
          var dt = (t - lastT) / 1000;
          lastT = t;

          if(dir !== 0){
            var speed = api.isAuto ? SPEED_AUTO : SPEED_USER;
            offset += dir * speed * dt;

            if(slides.length >= 3){
              var min = 0;
              var max = (realCount + 1) * slideW;

              if(offset >= max){
                offset = slideW;              // terug naar echte eerste
              }else if(offset <= min){
                offset = realCount * slideW;  // naar echte laatste
              }
            }else{
              var max2 = (slides.length - 1) * slideW;
              if(offset >= max2) offset = 0;
              if(offset < 0) offset = max2;
            }

            apply();
          }

          raf = requestAnimationFrame(tick);
        }

        function startRAF(newDir, isAuto){
          api.isAuto = !!isAuto;   // true = auto, false = user
          dir = newDir;
          if(raf) return;
          lastT = 0;
          raf = requestAnimationFrame(tick);
        }


        function stopMove(){
          dir = 0;
          stopRAF();
        }

        function clearAutoTimer(){
          if(autoTimer){
            clearTimeout(autoTimer);
            autoTimer = null;
          }
        }

        function stopAll(){
          clearAutoTimer();
          stopMove();
        }

        function maybeScheduleAuto(){
          clearAutoTimer();
          if(!inView) return;
          if(hovering) return;

          autoTimer = setTimeout(function(){
            // check opnieuw op moment van starten
            if(!inView) return;
            if(hovering) return;
            startRAF(autoDir, true);
          }, AUTO_DELAY);
        }

        function setHover(state){
          hovering = state;
          if(hovering){
            // user neemt over
            stopAll();
          }else{
            // user weg -> na delay auto door
            maybeScheduleAuto();
          }
        }

        // init
        recalc();

        // resize: behoud ongeveer dezelfde "index"
        window.addEventListener("resize", function(){
          var oldW = slideW || frame.clientWidth;
          var idx = oldW ? (offset / oldW) : 0;
          recalc();
          offset = idx * slideW;
          apply();
        });

        // Hover gedrag (pauzeert auto zodra je erop zit)
        frame.addEventListener("mouseenter", function(){ setHover(true); });
        frame.addEventListener("mouseleave", function(){
          setHover(false);
          stopMove(); // stop ook manual push als je uit de slider gaat
        });

        // User control via zones
        leftZone.addEventListener("mouseenter", function(){
          setHover(true);
          startRAF(-1, false);
        });
        rightZone.addEventListener("mouseenter", function(){
          setHover(true);
          startRAF(1, false);
        });

        leftZone.addEventListener("mouseleave", function(){
          stopMove();
          setHover(false);
        });
        rightZone.addEventListener("mouseleave", function(){
          stopMove();
          setHover(false);
        });

        // “API” voor IntersectionObserver
        frame.__sliderApi = {
          get inView(){ return inView; },
          set inView(v){ inView = !!v; },
          stopAll: stopAll,
          maybeScheduleAuto: maybeScheduleAuto
        };

        // observe in-view
        if(io){
          io.observe(frame);
        }else{
          // fallback zonder IO: meteen schedulen
          inView = true;
          maybeScheduleAuto();
        }
      });
    }

    (function(){
      var dict = {
        nl: {
          name: "YA'GEL SCHOONDERBEEK",
          intro_label: "DAKLOZENOPVANG DE KLOOF",
          intro_meta: "sinds 2023 kom ik elke donderdagochtend naar de kloof om 60 maaltijden te bereiden\n\n Tussen 9am en 1pm moet alles gebeuren vanaf: van het recept bedenken tot boodschappen tot service. Gelukkig komen vrienden en familie vaak helpen :-)\n\nDit is de plek waar mijn passie voor koken is begonnen.",
          pill_home: "HOME",
          pill_cheffie: "CHEF YAKKI",
          pill_contact: "CONTACT"
        },
        en: {
          name: "YA'GEL SCHOONDERBEEK",
          intro_label: "HOMELESS SHELTER DE KLOOF",
          intro_meta: "since 2023, i come in every thursday morning at De Kloof to prepare 60 meals\n\nBetween 9am and 1pm, everything has to be done: from recipe design to groceries to service. Luckily, friends and family often help out :-)\n\nThis is the place where my passion for cooking started.",
          pill_home: "HOME",
          pill_cheffie: "CHEF YAKKI",
          pill_contact: "CONTACT"
        }
      };

      function applyLang(lang){
        var pack = dict[lang] || dict.nl;

        // DOM state (for CSS hooks)
        document.documentElement.lang = lang;
        document.documentElement.setAttribute("data-lang", lang);

        // Text replacements
        document.querySelectorAll("[data-i18n]").forEach(function(el){
          var key = el.getAttribute("data-i18n");
          if(pack[key]) el.textContent = pack[key];
        });

        // Toggle button state
        document.querySelectorAll(".lang-btn").forEach(function(btn){
          btn.setAttribute(
            "aria-pressed",
            btn.getAttribute("data-lang") === lang ? "true" : "false"
          );
        });

        // Persistence across pages
        localStorage.setItem("yagel_lang", lang);
      }

      var initial = localStorage.getItem("lang") || document.documentElement.lang || "nl";
      if(!dict[initial]) initial = "nl";

      applyLang(initial);

      document.querySelectorAll(".lang-btn").forEach(function(btn){
        btn.addEventListener("click", function(){
          applyLang(btn.getAttribute("data-lang"));
        });
      });
    })();
  </script>

  <script>
    (function () {
      const user = "yagelschoonderbeek";
      const domain = "gmail.com";
      const link = document.getElementById("contactLink");
      if (!link) return;

      link.addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = "mailto:" + user + "@" + domain;
      });
    })();
  </script>
  
    <!-- <script>
      document.documentElement.classList.toggle(
        'is-safari',
        /^((?!chrome|android).)*safari/i.test(navigator.userAgent)
      );
    </script> -->

    <!-- <script>
      window.addEventListener('load', () => {
        const root = document.getElementById('sets-root')

        for (const tile of root.children) {
          const tileRect = tile.getBoundingClientRect()

          const slider = tile.querySelector('.slider-frame')
          const sliderHeight = slider
            ? slider.getBoundingClientRect().height
            : 'no slider'

          console.log({
            tile: tile.className,
            tileHeight: tileRect.height,
            sliderHeight
          })
        }
      })
    </script> -->

</body>
</html>
