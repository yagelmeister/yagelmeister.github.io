<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yagel.nl - de kloof</title>
  <meta name="description" content="meals for homeless people" />

  <link rel="stylesheet" href="styling.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
  <div class="wrap">
    <header>
      <div class="topbar" aria-label="Taal kiezen">
        <button class="lang-btn" type="button" data-lang="nl" aria-pressed="true">nl</button>
        <button class="lang-btn" type="button" data-lang="en" aria-pressed="false">en</button>
      </div>

      <div class="name">
        <a href="home.html" data-i18n="name">YA'GEL SCHOONDERBEEK</a>
      </div>
      <div class="rule"></div>
    </header>

    <main class="grid mosaic" aria-label="DE KLOOF">
      <div class="card tilt-1 span-3 row-1">
        <div>
          <div class="label" data-i18n="intro_label">DAKLOZENOPVANG DE KLOOF</div>
          <!-- <div class="meta" data-i18n="intro_meta">Elke donderdagochtend kook ik bij De Kloof een maaltijd voor de lunch. Om 9 uur kom ik binnen, inventariseer wat er is en beslis het menu. Vervolgens heb ik vaak nog drie en een half uur om boodschappen te doen en alles te bereiden. Gelukkig komen vrienden en familie vaak helpen. Dit is de plek waar mijn passie voor koken is begonnen.</div> -->
        </div>
      </div>

      <div id="sets-root" style="display: contents;"></div>
    </main>

    <footer>
      <a class="pill" href="cheffie.html" data-i18n="pill_cheffie">CHEF YAKKI</a>
      <a class="pill" href="home.html" data-i18n="pill_home">HOME</a>
      <a class="pill" href="#" id="contactLink" data-i18n="pill_contact">CONTACT</a>
    </footer>
  </div>

  <script>
    (function(){
      var savedTheme = localStorage.getItem("theme");
      document.documentElement.setAttribute("data-theme", savedTheme || "auto");
    })();

    var SETS = [
      {
        title: { nl: "TORTILLAS MET MARTIJN", en: "TORTILLAS WITH MARTIJN" },
        desc:  { nl: "Mijn data-baas kwam mee tortillas maken; van deeg tot salsa.", en: "My data-employer join to make tortillas; from dough to salsa." },
        photos: [
          "images/koken/daklozenopvang/tortillas1.jpg",
          "images/koken/daklozenopvang/tortillas3.jpg",
          "images/koken/daklozenopvang/tortillas2.jpg"
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-3"
      },
      {
        title: { nl: "Spatial Sensations", en: "Spatial Sensations" },
        desc:  { nl: "Onze zintuigen ervaren samen met De Sering.", en: "Experiencing our senses together with De Sering" },
        photos: [
          "images/muziek/mps/spatial/spatial_01.jpg",
          "images/muziek/mps/spatial/spatial_02.jpg",
          "images/muziek/mps/spatial/spatial_03.jpg",
          "images/muziek/mps/spatial/spatial_04.jpg",
          "images/muziek/mps/spatial/spatial_05.jpg",
          "images/muziek/mps/spatial/spatial_06.jpg",
          "images/muziek/mps/spatial/spatial_07.jpg",
          "images/muziek/mps/spatial/spatial_08.jpg"
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-1"
      },
      {
        title: { nl: "Rita's leefhuis", en: "Rita's living space" },
        desc:  { nl: "Een bandjes middag in een woonkerk in Amsterdam Noord.", en: "A live-music day in a living space in Amsterdam Noord." },
        photos: ["images/mps_01.jpg","images/mps_02.jpg","images/mps_03.jpg"],
        size:  "span-3 row-2",
        tilt:  "tilt-2"
      }
    ];

    function escapeHtml(str){
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    var SLIDER_LABELS = {
      nl: { prev: "vorige", next: "volgende" },
      en: { prev: "prev", next: "next" }
    };

    function renderSets(lang){
      var root = document.getElementById("sets-root");
      if(!root) return;
      root.innerHTML = "";

      SETS.forEach(function(s, idx){
        var card = document.createElement("div");
        card.className = "card player " + (s.tilt || "") + " " + (s.size || "");

        var title = (s.title && (s.title[lang] || s.title.nl)) || "Set";
        var desc  = s.desc ? (s.desc[lang] || s.desc.nl || "") : "";
        var photos = Array.isArray(s.photos) ? s.photos : [];
        var sliderId = "slider-" + idx;

        var labels = SLIDER_LABELS[lang] || SLIDER_LABELS.en;

        var photos = Array.isArray(s.photos) ? s.photos : [];
        var first = photos[0];
        var last  = photos[photos.length - 1];

        var loopPhotos;
        if(photos.length > 1){
          loopPhotos = [last].concat(photos).concat([first]); // clone-last + echte fotos + clone-first
        }else{
          loopPhotos = photos.slice();
        }

        card.innerHTML =
          '<div>' +
            '<div class="label">' + escapeHtml(title) + '</div>' +
            '<div class="meta">photos</div>' +
            (desc ? '<div class="desc">' + escapeHtml(desc) + '</div>' : '') +

            '<div class="slider" data-slider-id="' + sliderId + '">' +
              '<div class="slider-frame" aria-label="photo slider">' +

                '<div class="slider-track">' +
                  loopPhotos.map(function(p){
                    return '<img loading="eager" decoding="async" src="' + escapeHtml(p) + '" alt="">';
                  }).join("") +
                '</div>' +

                '<div class="slider-overlay" aria-hidden="true">' +
                  '<div class="slider-hover left"></div>' +
                  '<div class="slider-hover right"></div>' +
                '</div>' +

              '</div>' +
            '</div>' +

          '</div>';


        root.appendChild(card);
      });

      wireSliders();
    }

    function wireSliders(){
      var SPEED_AUTO = 60;       // px per soconde
      var SPEED_USER = 100;       // px per soconde
      var AUTO_DELAY = 2000;      // ms wachten na in-beeld komen / mouseleave
      var VIEW_THRESHOLD = 1.0;  // hoeveel van de slider in beeld moet zijn

      var io = ("IntersectionObserver" in window) ? new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          var frame = entry.target;
          var api = frame.__sliderApi;
          if(!api) return;

          api.inView = entry.isIntersecting && entry.intersectionRatio >= VIEW_THRESHOLD;

          if(!api.inView){
            api.stopAll();
          }else{
            api.maybeScheduleAuto();
          }
        });
      }, { threshold: [1] }) : null;

      document.querySelectorAll(".slider").forEach(function(slider){
        var frame = slider.querySelector(".slider-frame");
        var track = slider.querySelector(".slider-track");
        if(!frame || !track) return;

        var slides = Array.from(track.querySelectorAll("img"));
        if(slides.length < 2) return;

        var leftZone  = slider.querySelector(".slider-hover.left");
        var rightZone = slider.querySelector(".slider-hover.right");
        if(!leftZone || !rightZone) return;

        var dir = 0;
        var raf = null;
        var lastT = 0;

        var offset = 0;     // px
        var slideW = 0;     // px
        var realCount = 0;  // echte fotos (zonder clones)

        var hovering = false;
        var inView = false;

        var autoTimer = null;
        var autoDir = 1; // standaard auto naar rechts

        var api = { isAuto: false };

        function apply(){
          track.style.transform = "translateX(" + (-offset) + "px)";
        }

        function recalc(){
          slideW = frame.clientWidth;
          realCount = slides.length >= 3 ? (slides.length - 2) : slides.length;

          // startpositie: echte eerste (index 1) als we clones hebben
          if(slides.length >= 3 && offset === 0){
            offset = slideW;
          }
          apply();
        }

        function stopRAF(){
          if(raf){
            cancelAnimationFrame(raf);
            raf = null;
          }
          lastT = 0;
        }

        function tick(t){
          if(!lastT) lastT = t;
          var dt = (t - lastT) / 1000;
          lastT = t;

          if(dir !== 0){
            var speed = api.isAuto ? SPEED_AUTO : SPEED_USER;
            offset += dir * speed * dt;

            if(slides.length >= 3){
              var min = 0;
              var max = (realCount + 1) * slideW;

              if(offset >= max){
                offset = slideW;              // terug naar echte eerste
              }else if(offset <= min){
                offset = realCount * slideW;  // naar echte laatste
              }
            }else{
              var max2 = (slides.length - 1) * slideW;
              if(offset >= max2) offset = 0;
              if(offset < 0) offset = max2;
            }

            apply();
          }

          raf = requestAnimationFrame(tick);
        }

        function startRAF(newDir, isAuto){
          api.isAuto = !!isAuto;   // true = auto, false = user
          dir = newDir;
          if(raf) return;
          lastT = 0;
          raf = requestAnimationFrame(tick);
        }


        function stopMove(){
          dir = 0;
          stopRAF();
        }

        function clearAutoTimer(){
          if(autoTimer){
            clearTimeout(autoTimer);
            autoTimer = null;
          }
        }

        function stopAll(){
          clearAutoTimer();
          stopMove();
        }

        function maybeScheduleAuto(){
          clearAutoTimer();
          if(!inView) return;
          if(hovering) return;

          autoTimer = setTimeout(function(){
            // check opnieuw op moment van starten
            if(!inView) return;
            if(hovering) return;
            startRAF(autoDir, true);
          }, AUTO_DELAY);
        }

        function setHover(state){
          hovering = state;
          if(hovering){
            // user neemt over
            stopAll();
          }else{
            // user weg -> na delay auto door
            maybeScheduleAuto();
          }
        }

        // init
        recalc();

        // resize: behoud ongeveer dezelfde "index"
        window.addEventListener("resize", function(){
          var oldW = slideW || frame.clientWidth;
          var idx = oldW ? (offset / oldW) : 0;
          recalc();
          offset = idx * slideW;
          apply();
        });

        // Hover gedrag (pauzeert auto zodra je erop zit)
        frame.addEventListener("mouseenter", function(){ setHover(true); });
        frame.addEventListener("mouseleave", function(){
          setHover(false);
          stopMove(); // stop ook manual push als je uit de slider gaat
        });

        // User control via zones
        leftZone.addEventListener("mouseenter", function(){
          setHover(true);
          startRAF(-1, false);
        });
        rightZone.addEventListener("mouseenter", function(){
          setHover(true);
          startRAF(1, false);
        });

        leftZone.addEventListener("mouseleave", function(){
          stopMove();
          setHover(false);
        });
        rightZone.addEventListener("mouseleave", function(){
          stopMove();
          setHover(false);
        });

        // “API” voor IntersectionObserver
        frame.__sliderApi = {
          get inView(){ return inView; },
          set inView(v){ inView = !!v; },
          stopAll: stopAll,
          maybeScheduleAuto: maybeScheduleAuto
        };

        // observe in-view
        if(io){
          io.observe(frame);
        }else{
          // fallback zonder IO: meteen schedulen
          inView = true;
          maybeScheduleAuto();
        }
      });
    }

    (function(){
      var dict = {
        nl: {
          name: "YA'GEL SCHOONDERBEEK",
          // intro_label: "DAKLOZENOPVANG DE KLOOF",
          intro_label: "Elke donderdag kook ik bij De Kloof een maaltijd\nOm 9 uur 's ochtends kom ik aan, inventariseer wat er is en bedenk het menu\n\nVervolgens heb ik 3 uur voor boodschappen en het bereiden\nGelukkig komen vrienden en familie vaak helpen\n\nDit is de plek waar mijn passie voor koken is begonnen.",
          pill_home: "HOME",
          pill_cheffie: "CHEF YAKKI",
          pill_contact: "CONTACT"
        },
        en: {
          name: "YA'GEL SCHOONDERBEEK",
          // intro_label: "HOMELESS SHELTER DE KLOOF",
          intro_label: "Every Thursday I cook a meal at De Kloof\nI arrive at 9am, take inventory and formulate a recipe\n\nThen I have 3 hours for shopping and preparations\nLuckily, friends and family often help out\n\nThis is the place where my passion for cooking started",
          pill_home: "HOME",
          pill_cheffie: "CHEF YAKKI",
          pill_contact: "CONTACT"
        }
      };

      function applyLang(lang){
        var pack = dict[lang] || dict.nl;
        document.documentElement.lang = lang;

        document.querySelectorAll("[data-i18n]").forEach(function(el){
          var key = el.getAttribute("data-i18n");
          if(pack[key]) el.textContent = pack[key];
        });

        document.querySelectorAll(".lang-btn").forEach(function(btn){
          var isOn = btn.getAttribute("data-lang") === lang;
          btn.setAttribute("aria-pressed", isOn ? "true" : "false");
        });

        localStorage.setItem("lang", lang);
        renderSets(lang);
      }

      var initial = localStorage.getItem("lang") || document.documentElement.lang || "nl";
      if(!dict[initial]) initial = "nl";

      applyLang(initial);

      document.querySelectorAll(".lang-btn").forEach(function(btn){
        btn.addEventListener("click", function(){
          applyLang(btn.getAttribute("data-lang"));
        });
      });
    })();
  </script>

  <script>
    (function () {
      const user = "yagelschoonderbeek";
      const domain = "gmail.com";
      const link = document.getElementById("contactLink");
      if (!link) return;

      link.addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = "mailto:" + user + "@" + domain;
      });
    })();
  </script>
</body>
</html>
