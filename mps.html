<!doctype html>
<html>
<head>
  <script>
    (function(){
      var lang = localStorage.getItem("yagel_lang") || "en";
      document.documentElement.setAttribute("data-lang", lang);
      document.documentElement.lang = lang;
    })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yagel.nl - mps</title>
  <meta name="description" content="mpsoundsystem — photos & sessions." />

  <link rel="stylesheet" href="styling.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
  <div class="wrap">
    <header>
      <div class="topbar" aria-label="Taal kiezen">
        <button class="lang-btn" type="button" data-lang="nl" aria-pressed="true">nl</button>
        <button class="lang-btn" type="button" data-lang="en" aria-pressed="false">en</button>
      </div>

      <div class="name">
        <a href="home.html" data-i18n="name">YA'GEL SCHOONDERBEEK</a>
      </div>
      <div class="rule"></div>
    </header>

    <main class="masonry" aria-label="mpsoundsystem">
      <div id="col-a" class="masonry-col">
        <!-- put the intro tile here -->
        <div class="card intro tilt-1">
          <div class="label" data-i18n="mps_label">MPSOUNDSYSTEM</div>
          <div class="meta" data-i18n="mps_meta">I co-founded A collective that looks to create (music) culture together as a community. By upcycling second hand gear, culture is made (financially) accessible</div>
        </div>
      </div>
      <div id="col-b" class="masonry-col"></div>
    </main>

    <footer>
      <a class="pill" href="music.html" data-i18n="pill_music">MUZIEK</a>
      <a class="pill" href="home.html" data-i18n="pill_home">HOME</a>
      <a class="pill" href="#" id="contactLink" data-i18n="pill_contact">CONTACT</a>
    </footer>
  </div>

  <script>
    var IS_SAFARI = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

    (function(){
      var savedTheme = localStorage.getItem("theme");
      document.documentElement.setAttribute("data-theme", savedTheme || "auto");
    })();

    var SETS = [
      {
        title: { nl: "ADE '24 RAVE", en: "ADE '24 RAVE" },
        desc:  { nl: "een ontvluchting van de stad en haar commerciele achtbaan", en: "an escape from the city and its commercial rollercoaster" },
        photos: [
          "images/muziek/mps/rave/mps_rave_1_01.png",
          "images/muziek/mps/rave/mps_rave_1_02.png",
          "images/muziek/mps/rave/mps_rave_1_03.png",
          "images/muziek/mps/rave/mps_rave_1_04.png",
          "images/muziek/mps/rave/mps_rave_1_05.png",
          "images/muziek/mps/rave/mps_rave_1_06.png",
          "images/muziek/mps/rave/mps_rave_1_07.png",
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-2"
      },
      {
        title: { nl: "Zuiderzeeweg festival '24", en: "Zuiderzeeweg festival '24" },
        desc:  { nl: "het allerlaaste zuiderzeeweg festival was de legendarische start van mps", en: "the very last zuiderzeeweg festival was the legendary start of mps" },
        photos: [
          "images/muziek/mps/zzw/NIGHT-01.PNG",
          "images/muziek/mps/zzw/NIGHT-02.PNG",
          "images/muziek/mps/zzw/NIGHT-03.PNG",
          "images/muziek/mps/zzw/NIGHT-04.PNG",
          "images/muziek/mps/zzw/NIGHT-05.PNG",
          "images/muziek/mps/zzw/DAY-02.PNG",
          "images/muziek/mps/zzw/DAY-03.PNG",
          "images/muziek/mps/zzw/DAY-04.PNG",
          "images/muziek/mps/zzw/DAY-05.PNG",
          "images/muziek/mps/zzw/DAY-06.PNG",
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-2"
      },
      {
        title: { nl: "Spatial Sensations", en: "Spatial Sensations" },
        desc:  { nl: "onze zintuigen ervaren samen met de sering", en: "experiencing our senses together with de sering" },
        photos: [
          "images/muziek/mps/spatial/spatial_01.jpg",
          "images/muziek/mps/spatial/spatial_02.jpg",
          "images/muziek/mps/spatial/spatial_03.jpg",
          "images/muziek/mps/spatial/spatial_04.jpg",
          "images/muziek/mps/spatial/spatial_05.jpg",
          "images/muziek/mps/spatial/spatial_06.jpg",
          "images/muziek/mps/spatial/spatial_07.jpg",
          "images/muziek/mps/spatial/spatial_08.jpg"
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-1"
      },
      {
        title: { nl: "NYE 2024", en: "NYE 2024" },
        desc:  { nl: "een emotioneel afscheid aan het gesloopte zuiderzeeweg", en: "an emotional goodbye to the deconstructed zuiderzeeweg" },
        photos: [
          "images/muziek/mps/nye/night2_01.jpg",
          "images/muziek/mps/nye/night2_02.jpg",
          "images/muziek/mps/nye/night2_03.jpg"
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-3"
      },
      // {
      //   title: { nl: "Rita's leefhuis", en: "Rita's living space" },
      //   desc:  { nl: "Een bandjes middag in een woonkerk in Amsterdam Noord.", en: "A live-music day in a living space in Amsterdam Noord." },
      //   photos: ["images/mps_01.jpg","images/mps_02.jpg","images/mps_03.jpg"],
      //   size:  "span-3 row-2",
      //   tilt:  "tilt-2"
      // },
      {
        title: { nl: "La Salinié Festival '25", en: "La Salinié Festival '25" },
        desc:  { nl: "een hete viering van co-creatie", en: "a hot celebration of co-creation" },
        photos: [
          "images/muziek/mps/salinie/salinie2_01.jpg",
          "images/muziek/mps/salinie/salinie2_02.jpg",
          "images/muziek/mps/salinie/salinie2_03.jpg",
          "images/muziek/mps/salinie/salinie2_04.jpg",
          "images/muziek/mps/salinie/salinie2_05.jpg",
          "images/muziek/mps/salinie/salinie2_06.jpg",
          "images/muziek/mps/salinie/salinie2_07.jpg",
          "images/muziek/mps/salinie/salinie2_08.jpg",
          "images/muziek/mps/salinie/salinie2_09.jpg",
          "images/muziek/mps/salinie/salinie2_10.jpg",
        ],
        size:  "span-3 row-2",
        tilt:  "tilt-2"
      },
    ];

    function escapeHtml(str){
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    var SLIDER_LABELS = {
      nl: { prev: "vorige", next: "volgende" },
      en: { prev: "prev", next: "next" }
    };

    function renderSets(lang){
      var colA = document.getElementById('col-a');
      if(!colA) return;
      var colB = document.getElementById('col-b');
      if(!colB) return;


      SETS.forEach(function(s, idx){
        var card = document.createElement("div");
        card.setAttribute("data-set-card", "1");
        card.className = "card player " + (s.tilt || "") + " " + (s.size || "");
        

        var title = (s.title && (s.title[lang] || s.title.nl)) || "Set";
        var desc  = s.desc ? (s.desc[lang] || s.desc.nl || "") : "";
        var photos = Array.isArray(s.photos) ? s.photos : [];
        var sliderId = "slider-" + idx;

        var labels = SLIDER_LABELS[lang] || SLIDER_LABELS.en;

        var photos = Array.isArray(s.photos) ? s.photos : [];
        var first = photos[0];
        var last  = photos[photos.length - 1];

        var loopPhotos;
        if(photos.length > 1){
          loopPhotos = [last].concat(photos).concat([first]); // clone-last + echte fotos + clone-first
        }else{
          loopPhotos = photos.slice();
        }

        card.innerHTML =
          '<div>' +
            '<div class="label">' + escapeHtml(title) + '</div>' +
            '<div class="meta">photos</div>' +
            (desc ? '<div class="desc">' + escapeHtml(desc) + '</div>' : '') +

            '<div class="slider" data-slider-id="' + sliderId + '">' +
              '<div class="slider-frame" aria-label="photo slider">' +

                '<div class="slider-track">' +
                  loopPhotos.map(function(p){
                    return '<img loading="eager" decoding="async" src="' + escapeHtml(p) + '" alt="">';
                  }).join("") +
                '</div>' +

                '<div class="slider-overlay" aria-hidden="true">' +
                  '<div class="slider-hover left"></div>' +
                  '<div class="slider-hover right"></div>' +
                '</div>' +

              '</div>' +
            '</div>' +

          '</div>';

        ((colA.offsetHeight <= colB.offsetHeight) ? colA : colB).appendChild(card);
      });

      wireSliders();
      autoAspectRatio();
    }

  function autoAspectRatio(){
    document.querySelectorAll(".slider-frame").forEach(function(frame){
      var imgs = Array.from(frame.querySelectorAll("img"));
      if(!imgs.length) return;

      var waits = imgs.map(function(img){
        return new Promise(function(resolve){
          if(img.complete && img.naturalWidth) return resolve();
          img.addEventListener("load", resolve, { once:true });
          img.addEventListener("error", resolve, { once:true });
        });
      });

      Promise.all(waits).then(function(){
        var maxRatio = 0;
        imgs.forEach(function(img){
          var w = img.naturalWidth || 0;
          var h = img.naturalHeight || 1;
          var r = w / h;
          if(r > maxRatio) maxRatio = r;
        });

        if(!maxRatio || !isFinite(maxRatio)) maxRatio = 16/9;
        frame.style.aspectRatio = String(maxRatio);
      });
    });
  }


   function wireSliders(){
      var SPEED_AUTO = 60;       // px per soconde
      var SPEED_USER = 100;       // px per soconde
      var AUTO_DELAY = 700;      // ms wachten na in-beeld komen / mouseleave
      var VIEW_THRESHOLD = 1.0;  // hoeveel van de slider in beeld moet zijn

      var io = ("IntersectionObserver" in window) ? new IntersectionObserver(function(entries){
        entries.forEach(function(entry){
          var frame = entry.target;
          var api = frame.__sliderApi;
          if(!api) return;

          api.inView = entry.isIntersecting && entry.intersectionRatio >= VIEW_THRESHOLD;

          if(!api.inView){
            api.stopAll();
          }else{
            api.maybeScheduleAuto();
          }
        });
      }, { threshold: [1] }) : null;

      document.querySelectorAll(".slider").forEach(function(slider){
        var frame = slider.querySelector(".slider-frame");
        var track = slider.querySelector(".slider-track");
        if(!frame || !track) return;

        var slides = Array.from(track.querySelectorAll("img"));
        if(slides.length < 2) return;

        var leftZone  = slider.querySelector(".slider-hover.left");
        var rightZone = slider.querySelector(".slider-hover.right");
        if(!leftZone || !rightZone) return;

        var dir = 0;
        var raf = null;
        var lastT = 0;

        var offset = 0;     // px
        var slideW = 0;     // px
        var realCount = 0;  // echte fotos (zonder clones)

        var hovering = false;
        var inView = false;

        var autoTimer = null;
        var autoDir = 1; // standaard auto naar rechts

        var api = { isAuto: false };

        function apply(){
          track.style.transform = "translateX(" + (-offset) + "px)";
        }

        function recalc(){
          slideW = frame.clientWidth;
          realCount = slides.length >= 3 ? (slides.length - 2) : slides.length;

          // startpositie: echte eerste (index 1) als we clones hebben
          if(slides.length >= 3 && offset === 0){
            offset = slideW;
          }
          apply();
        }

        function stopRAF(){
          if(raf){
            cancelAnimationFrame(raf);
            raf = null;
          }
          lastT = 0;
        }

        function tick(t){
          if(!lastT) lastT = t;
          var dt = (t - lastT) / 1000;
          lastT = t;

          if(dir !== 0){
            var speed = api.isAuto ? SPEED_AUTO : SPEED_USER;
            offset += dir * speed * dt;

            if(slides.length >= 3){
              var min = 0;
              var max = (realCount + 1) * slideW;

              if(offset >= max){
                offset = slideW;              // terug naar echte eerste
              }else if(offset <= min){
                offset = realCount * slideW;  // naar echte laatste
              }
            }else{
              var max2 = (slides.length - 1) * slideW;
              if(offset >= max2) offset = 0;
              if(offset < 0) offset = max2;
            }

            apply();
          }

          raf = requestAnimationFrame(tick);
        }

        function startRAF(newDir, isAuto){
          api.isAuto = !!isAuto;   // true = auto, false = user
          dir = newDir;
          if(raf) return;
          lastT = 0;
          raf = requestAnimationFrame(tick);
        }


        function stopMove(){
          dir = 0;
          stopRAF();
        }

        function clearAutoTimer(){
          if(autoTimer){
            clearTimeout(autoTimer);
            autoTimer = null;
          }
        }

        function stopAll(){
          clearAutoTimer();
          stopMove();
        }

        function maybeScheduleAuto(){
          clearAutoTimer();
          if(!inView) return;
          if(hovering) return;

          autoTimer = setTimeout(function(){
            // check opnieuw op moment van starten
            if(!inView) return;
            if(hovering) return;
            startRAF(autoDir, true);
          }, AUTO_DELAY);
        }

        function setHover(state){
          hovering = state;
          if(hovering){
            // user neemt over
            stopAll();
          }else{
            // user weg -> na delay auto door
            maybeScheduleAuto();
          }
        }

        // init
        recalc();

        // resize: behoud ongeveer dezelfde "index"
        window.addEventListener("resize", function(){
          var oldW = slideW || frame.clientWidth;
          var idx = oldW ? (offset / oldW) : 0;
          recalc();
          offset = idx * slideW;
          apply();
        });

        // Hover gedrag (pauzeert auto zodra je erop zit)
        frame.addEventListener("mouseenter", function(){ setHover(true); });
        frame.addEventListener("mouseleave", function(){
          setHover(false);
          stopMove(); // stop ook manual push als je uit de slider gaat
        });

        // User control via zones
        leftZone.addEventListener("mouseenter", function(){
          setHover(true);
          startRAF(-1, false);
        });
        rightZone.addEventListener("mouseenter", function(){
          setHover(true);
          startRAF(1, false);
        });

        leftZone.addEventListener("mouseleave", function(){
          stopMove();
          setHover(false);
        });
        rightZone.addEventListener("mouseleave", function(){
          stopMove();
          setHover(false);
        });

        // “API” voor IntersectionObserver
        frame.__sliderApi = {
          get inView(){ return inView; },
          set inView(v){ inView = !!v; },
          stopAll: stopAll,
          maybeScheduleAuto: maybeScheduleAuto
        };

        // observe in-view
        if(io){
          io.observe(frame);
        }else{
          // fallback zonder IO: meteen schedulen
          inView = true;
          maybeScheduleAuto();
        }
      });
    }

    (function(){
      var dict = {
        nl: {
          name: "YA'GEL SCHOONDERBEEK",
          mps_label: "MPSOUNDSYSTEM",
          mps_meta: "is een collectief om samen als een community (muziek)cultuur te maken. Door tweedehands gear van marktplaats te upcyclen, wordt cultuur laagdrempelig en (financieel) toegankelijk",
          pill_home: "HOME",
          pill_music: "MUZIEK",
          pill_contact: "CONTACT"
        },
        en: {
          name: "YA'GEL SCHOONDERBEEK",
          mps_label: "MPSOUNDSYSTEM",
          mps_meta: "is a collective that looks to create (music) culture together as a community\n\nBy upcycling second hand gear from the infamous marktplaats, culture such as outdoor cinema's, festival stages or conceptual dinners become (financially) accessible",
          pill_home: "HOME",
          pill_music: "MUSIC",
          pill_contact: "CONTACT"
        }
      };

      function applyLang(lang){
        var pack = dict[lang] || dict.nl;

        // DOM state (for CSS hooks)
        document.documentElement.lang = lang;
        document.documentElement.setAttribute("data-lang", lang);

        // Text replacements
        document.querySelectorAll("[data-i18n]").forEach(function(el){
          var key = el.getAttribute("data-i18n");
          if(pack[key]) el.textContent = pack[key];
        });

        // Toggle button state
        document.querySelectorAll(".lang-btn").forEach(function(btn){
          btn.setAttribute(
            "aria-pressed",
            btn.getAttribute("data-lang") === lang ? "true" : "false"
          );
        });

        // Persistence across pages
        localStorage.setItem("yagel_lang", lang);
      }

      var initial = localStorage.getItem("lang") || document.documentElement.lang || "nl";
      if(!dict[initial]) initial = "nl";

      applyLang(initial);

      document.querySelectorAll(".lang-btn").forEach(function(btn){
        btn.addEventListener("click", function(){
          applyLang(btn.getAttribute("data-lang"));
        });
      });
    })();
  </script>

  <script>
    (function () {
      const user = "yagelschoonderbeek";
      const domain = "gmail.com";
      const link = document.getElementById("contactLink");
      if (!link) return;

      link.addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = "mailto:" + user + "@" + domain;
      });
    })();
  </script>

  <script>
  (function safariDebug(){

    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
    console.log('%cDEBUG START', 'background:#000;color:#0f0;padding:4px');
    console.log('Browser:', isSafari ? 'Safari' : 'Not Safari');

    const tiles = document.querySelectorAll('.card, .tile');
    console.log('Tiles found:', tiles.length);

    tiles.forEach((tile, i) => {
      const rect = tile.getBoundingClientRect();
      const style = getComputedStyle(tile);

      console.group(`TILE ${i}`);
      console.log('height (rect):', rect.height);
      console.log('scrollHeight:', tile.scrollHeight);
      console.log('clientHeight:', tile.clientHeight);
      console.log('display:', style.display);
      console.log('position:', style.position);
      console.log('overflow:', style.overflow);
      console.log('aspect-ratio:', style.aspectRatio);
      console.log('grid-row:', style.gridRow);
      console.log('contains slider:', !!tile.querySelector('.slider-frame'));
      console.groupEnd();
    });

  })();
  </script>

  <script>
    setTimeout(() => {
      document.querySelectorAll('.slider-frame').forEach((frame, i) => {
        const frameRect = frame.getBoundingClientRect();
        const frameCS = getComputedStyle(frame);

        const track = frame.querySelector('.slider-track, .slides, .slider');
        const img = frame.querySelector('img, video');

        console.group(`SLIDERFRAME ${i}`);
        console.log('frame rect h:', frameRect.height);
        console.log('frame clientHeight:', frame.clientHeight, 'scrollHeight:', frame.scrollHeight);
        console.log('frame display:', frameCS.display, 'pos:', frameCS.position, 'overflow:', frameCS.overflow);
        console.log('frame height style:', frameCS.height, 'min-height:', frameCS.minHeight);

        if(track){
          const tRect = track.getBoundingClientRect();
          const tCS = getComputedStyle(track);
          console.log('track rect h:', tRect.height);
          console.log('track clientHeight:', track.clientHeight, 'scrollHeight:', track.scrollHeight);
          console.log('track display:', tCS.display, 'pos:', tCS.position, 'height:', tCS.height);
        } else {
          console.log('track: NOT FOUND');
        }

        if(img){
          const iRect = img.getBoundingClientRect();
          const iCS = getComputedStyle(img);
          console.log('media tag:', img.tagName);
          console.log('media rect h:', iRect.height);
          console.log('media pos:', iCS.position, 'height:', iCS.height, 'object-fit:', iCS.objectFit);
        } else {
          console.log('media: NOT FOUND');
        }

        console.groupEnd();
      });
    }, 800);
    </script>

    <script>
      document.documentElement.classList.toggle(
        'is-safari',
        /^((?!chrome|android).)*safari/i.test(navigator.userAgent)
      );
    </script>
</body>
</html>
